<template>
<div>
    <div class="index-strategy-each-tabs-head">
        <p>Pre-tax Plan Data</p>
        <svg width="32" height="33" viewBox="0 0 32 33" fill="none">
            <g id="Clip path group" filter="url(#filter0_d_332_2464)">
                <mask id="mask0_332_2464" style="mask-type:luminance"
                    maskUnits="userSpaceOnUse" x="4" y="2" width="24" height="25">
                    <g id="461b897740">
                        <path id="Vector" d="M4 2H28V26.2959H4V2Z" fill="white" />
                    </g>
                </mask>
                <g mask="url(#mask0_332_2464)">
                    <g id="Group">
                        <path id="Vector_2" class="setting-icon-all"
                            d="M10.6024 14.2504C9.65457 14.2504 8.88658 13.4454 8.88658 12.4526C8.88658 11.4598 9.65457 10.6551 10.6024 10.6551C11.55 10.6551 12.3183 11.4598 12.3183 12.4526C12.3183 13.4454 11.55 14.2504 10.6024 14.2504ZM16.9677 11.5253L16.6235 11.4719C16.1338 11.3955 15.7232 11.0453 15.5534 10.5583C15.5024 10.4123 15.446 10.2694 15.3838 10.1292C15.1747 9.6575 15.2262 9.10404 15.522 8.68575L15.7293 8.39273C15.8113 8.27705 15.8 8.11568 15.7024 8.01374L14.8393 7.10942C14.7418 7.00748 14.5881 6.99534 14.4774 7.0813L14.1979 7.29859C13.7988 7.60823 13.2704 7.66224 12.8198 7.44303C12.6866 7.37784 12.55 7.31872 12.4107 7.26536C11.946 7.08769 11.6113 6.65726 11.5387 6.14438L11.4875 5.78361C11.4674 5.64109 11.3503 5.53532 11.2128 5.53532H9.99177C9.85427 5.53532 9.7375 5.64109 9.71707 5.78361L9.66585 6.14438C9.59329 6.65726 9.25884 7.08769 8.7939 7.26536C8.65457 7.31872 8.51829 7.37784 8.38476 7.44303C7.93445 7.66224 7.4061 7.60823 7.00701 7.29859L6.72713 7.0813C6.61677 6.99534 6.4628 7.00748 6.36555 7.10942L5.50213 8.01374C5.40488 8.11568 5.39329 8.27705 5.4753 8.39273L5.68262 8.68575C5.97835 9.10404 6.02988 9.6575 5.82073 10.1292C5.75884 10.2694 5.70213 10.4123 5.65122 10.5583C5.4814 11.0453 5.07073 11.3955 4.5811 11.4719L4.23689 11.5253C4.10091 11.5467 4 11.6687 4 11.8132V13.0923C4 13.2364 4.10091 13.3592 4.23689 13.3802L4.5811 13.4339C5.07073 13.51 5.4814 13.8602 5.65122 14.3472C5.70213 14.4932 5.75884 14.6364 5.82073 14.776C6.02988 15.248 5.97835 15.8018 5.68262 16.2198L5.4753 16.5125C5.39329 16.6285 5.40488 16.7898 5.50213 16.8918L6.36555 17.7964C6.4628 17.898 6.61677 17.9102 6.72713 17.8245L7.00701 17.6069C7.4061 17.2973 7.93445 17.2433 8.38476 17.4625C8.51829 17.5274 8.65457 17.5865 8.7939 17.6398C9.25884 17.8178 9.59329 18.2483 9.66585 18.7611L9.71707 19.1219C9.7375 19.2644 9.85427 19.3702 9.99177 19.3702H11.2128C11.3503 19.3702 11.4674 19.2644 11.4875 19.1219L11.5387 18.7611C11.6113 18.2483 11.946 17.8178 12.4107 17.6398C12.55 17.5865 12.6866 17.5274 12.8198 17.4625C13.2704 17.2433 13.7988 17.2973 14.1979 17.6069L14.4774 17.8245C14.5881 17.9102 14.7418 17.898 14.8393 17.7964L15.7024 16.8918C15.8 16.7898 15.8113 16.6285 15.7293 16.5125L15.522 16.2198C15.2262 15.8018 15.1747 15.248 15.3838 14.776C15.446 14.6364 15.5024 14.4932 15.5534 14.3472C15.7232 13.8602 16.1338 13.51 16.6235 13.4339L16.9677 13.3802C17.1037 13.3592 17.2046 13.2364 17.2046 13.0923V11.8132C17.2046 11.6687 17.1037 11.5467 16.9677 11.5253ZM21.3979 21.1677C20.4503 21.1677 19.682 20.363 19.682 19.3702C19.682 18.3774 20.4503 17.5724 21.3979 17.5724C22.3454 17.5724 23.1137 18.3774 23.1137 19.3702C23.1137 20.363 22.3454 21.1677 21.3979 21.1677ZM27.7634 18.4425L27.4192 18.3889C26.9296 18.3128 26.5189 17.9626 26.3488 17.4756C26.2982 17.3295 26.2415 17.1864 26.1793 17.0467C25.9701 16.5748 26.0219 16.021 26.3177 15.6033L26.5247 15.31C26.6067 15.1943 26.5954 15.033 26.4982 14.931L25.6348 14.0264C25.5375 13.9244 25.3835 13.9126 25.2729 13.9983L24.9933 14.2155C24.5942 14.5255 24.0659 14.5798 23.6155 14.3603C23.482 14.2954 23.3454 14.2363 23.2064 14.183C22.7415 14.005 22.407 13.5745 22.3341 13.0617L22.2832 12.7009C22.2631 12.5584 22.146 12.4526 22.0082 12.4526H20.7875C20.6497 12.4526 20.5329 12.5584 20.5128 12.7009L20.4616 13.0617C20.3887 13.5745 20.0543 14.005 19.5896 14.183C19.4503 14.2363 19.3137 14.2954 19.1802 14.3603C18.7299 14.5798 18.2015 14.5255 17.8027 14.2155L17.5229 13.9983C17.4122 13.9126 17.2582 13.9244 17.161 14.0264L16.2979 14.931C16.2003 15.033 16.189 15.1943 16.271 15.31L16.4784 15.6033C16.7738 16.021 16.8253 16.5748 16.6162 17.0467C16.5543 17.1864 16.4976 17.3295 16.4466 17.4756C16.2771 17.9626 15.8662 18.3128 15.3768 18.3889L15.0323 18.4425C14.8963 18.4636 14.7957 18.5863 14.7957 18.7305V20.0096C14.7957 20.1537 14.8963 20.2764 15.0323 20.2975L15.3768 20.3509C15.8662 20.4273 16.2771 20.7775 16.4466 21.2645C16.4976 21.4105 16.5543 21.5537 16.6162 21.6933C16.8253 22.1653 16.7738 22.7187 16.4784 23.1367L16.271 23.4301C16.189 23.5457 16.2003 23.7071 16.2979 23.809L17.161 24.7137C17.2582 24.8153 17.4122 24.8274 17.5229 24.7415L17.8027 24.5242C18.2015 24.2142 18.7299 24.1605 19.1802 24.3798C19.3137 24.4446 19.4503 24.5041 19.5896 24.5574C20.0546 24.7351 20.3887 25.1655 20.4616 25.6784L20.5128 26.0392C20.5329 26.1817 20.6497 26.2875 20.7875 26.2875H22.0082C22.146 26.2875 22.2631 26.1817 22.2832 26.0392L22.3341 25.6784C22.407 25.1655 22.7415 24.7351 23.2064 24.5574C23.3454 24.5041 23.482 24.4446 23.6155 24.3798C24.0659 24.1605 24.5942 24.2142 24.9933 24.5242L25.2729 24.7415C25.3835 24.8274 25.5375 24.8153 25.6348 24.7137L26.4982 23.809C26.5954 23.7071 26.6067 23.5457 26.5247 23.4301L26.3177 23.1367C26.0219 22.7187 25.9701 22.1653 26.1793 21.6933C26.2415 21.5537 26.2982 21.4105 26.3488 21.2645C26.5189 20.7775 26.9296 20.4273 27.4192 20.3509L27.7634 20.2975C27.8994 20.2764 28.0003 20.1537 28.0003 20.0096V18.7305C28.0003 18.5863 27.8994 18.4636 27.7634 18.4425ZM20.436 8.36493C19.721 8.36493 19.1415 7.75746 19.1415 7.00876C19.1415 6.25974 19.721 5.65259 20.436 5.65259C21.1509 5.65259 21.7302 6.25974 21.7302 7.00876C21.7302 7.75746 21.1509 8.36493 20.436 8.36493ZM25.0357 6.33867L24.7869 6.29968C24.4332 6.24472 24.1363 5.99164 24.0134 5.63981C23.9768 5.53436 23.936 5.43083 23.8909 5.32985C23.7399 4.98889 23.7771 4.58882 23.9909 4.28684L24.1405 4.07498C24.1997 3.99158 24.1915 3.87462 24.1213 3.80113L23.4976 3.14765C23.4271 3.07383 23.3159 3.06521 23.236 3.12752L23.0338 3.2841C22.7454 3.5081 22.3637 3.54741 22.0384 3.38891C21.9421 3.34194 21.8433 3.29912 21.7427 3.26045C21.4067 3.13199 21.1652 2.82075 21.1125 2.45039L21.0753 2.18996C21.061 2.08675 20.9765 2.01038 20.8771 2.01038H19.9948C19.8954 2.01038 19.811 2.08675 19.796 2.18996L19.7594 2.45039C19.7067 2.82075 19.4652 3.13199 19.1293 3.26045C19.0287 3.29912 18.9299 3.34194 18.8335 3.38891C18.5079 3.54741 18.1262 3.5081 17.8378 3.2841L17.636 3.12752C17.5558 3.06521 17.4445 3.07383 17.3744 3.14765L16.7506 3.80113C16.6805 3.87462 16.6719 3.99158 16.7311 4.07498L16.8811 4.28684C17.0948 4.58882 17.132 4.98889 16.9808 5.32985C16.936 5.43083 16.8951 5.53436 16.8582 5.63981C16.7357 5.99164 16.4387 6.24472 16.0851 6.29968L15.8363 6.33867C15.7381 6.35368 15.6652 6.4422 15.6652 6.54669V7.47083C15.6652 7.575 15.7381 7.66352 15.8363 7.67885L16.0851 7.71752C16.4387 7.7728 16.7357 8.02588 16.8582 8.37771C16.8951 8.48316 16.936 8.58637 16.9808 8.68767C17.132 9.02831 17.0948 9.4287 16.8811 9.73068L16.7311 9.94254C16.6719 10.0263 16.6805 10.1426 16.7506 10.2164L17.3744 10.8699C17.4445 10.9437 17.5558 10.952 17.636 10.89L17.8378 10.7331C18.1262 10.5091 18.5079 10.4704 18.8335 10.6286C18.9299 10.6756 19.0287 10.7184 19.1293 10.7571C19.4652 10.8855 19.7067 11.1964 19.7594 11.5671L19.796 11.8279C19.811 11.9311 19.8954 12.0071 19.9948 12.0071H20.8771C20.9765 12.0071 21.061 11.9311 21.0753 11.8279L21.1125 11.5671C21.1652 11.1964 21.4067 10.8855 21.7427 10.7571C21.8433 10.7184 21.9421 10.6756 22.0384 10.6286C22.3637 10.4704 22.7454 10.5091 23.0338 10.7331L23.236 10.89C23.3159 10.952 23.4271 10.9437 23.4976 10.8699L24.1213 10.2164C24.1915 10.1426 24.1997 10.0263 24.1405 9.94254L23.9909 9.73068C23.7771 9.4287 23.7399 9.02831 23.8909 8.68767C23.936 8.58637 23.9768 8.48316 24.0134 8.37771C24.1363 8.02588 24.4332 7.7728 24.7869 7.71752L25.0357 7.67885C25.1338 7.66352 25.2067 7.575 25.2067 7.47083V6.54669C25.2067 6.4422 25.1338 6.35368 25.0357 6.33867Z"
                            fill="#14EAB7" />
                    </g>
                </g>
            </g>
            <defs>
                <filter id="filter0_d_332_2464" x="0" y="0.010376" width="32"
                    height="32.2771" filterUnits="userSpaceOnUse"
                    color-interpolation-filters="sRGB">
                    <feFlood flood-opacity="0" result="BackgroundImageFix" />
                    <feColorMatrix in="SourceAlpha" type="matrix"
                        values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                        result="hardAlpha" />
                    <feOffset dy="2" />
                    <feGaussianBlur stdDeviation="2" />
                    <feComposite in2="hardAlpha" operator="out" />
                    <feColorMatrix type="matrix"
                        values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0" />
                    <feBlend mode="normal" in2="BackgroundImageFix"
                        result="effect1_dropShadow_332_2464" />
                    <feBlend mode="normal" in="SourceGraphic"
                        in2="effect1_dropShadow_332_2464" result="shape" />
                </filter>
            </defs>
        </svg>
    </div>

    <div class="container-fluid index-strategy-inputs-div">
        <h6 class="form-heading mb-0 pt-2">Account Details</h6>
        <div class="row">
            <div class="col-md-6 col-lg-3 inp-mar-top">
                <label for="beginningBalance">Pre-tax Plan Balance (401K/IRA)</label>
                <div class="index-strategy-each-inputs dollar">
                    <span>$</span>
                    <dollar-amount-input
                      @amountUpdated="a => updateInput('ira_or_401k_balance', a)"
                      :default="inputs.ira_or_401k_balance"
                      max="100000000"
                      placeholder="&nbsp;"
                    />
                </div>
            </div>
            <div class="col-md-6 col-lg-3 inp-mar-top">
                <label for="beginningBalance">Age</label>
                <div class="index-strategy-each-inputs">
                  <integer-input
                    @valueUpdated="v => updateInput('age', v)"
                    :default="inputs.age"
                    max="100"
                  />
                </div>
            </div>
            <div class="col-md-6 col-lg-3 inp-mar-top">
                <label for="beginningBalance">RMD Age <span><common-tooltip-svg />
                        <span>What year will RMDs start?</span>
                    </span></label>
                <div class="select-menu">
                  <div class="select-btn">
                    <span class="sBtn-text">{{inputs.rmd_age}}</span>
                    <i
                      ><img
                        src="@/assets/images/icons/select-chevron.svg"
                        alt="Chevron"
                    /></i>
                  </div>
                  <ul class="options">
                    <li :class="`option ${inputs.rmd_age === 72 ? 'active' : ''}`" @click="updateInput('rmd_age', 72)">
                      <span class="option-text">72</span>
                    </li>
                    <li :class="`option ${inputs.rmd_age === 73 ? 'active' : ''}`" @click="updateInput('rmd_age', 73)">
                      <span class="option-text">73</span>
                    </li>
                    <li :class="`option ${inputs.rmd_age === 75 ? 'active' : ''}`" @click="updateInput('rmd_age', 75)">
                      <span class="option-text">75</span>
                    </li>
                  </ul>
                </div>
            </div>
            <div class="col-md-6 col-lg-3 inp-mar-top">
                <label for="beginningBalance">Plan Through Age <span><common-tooltip-svg />
                        <span>Through what age should the analysis run?</span>
                    </span></label>
                <div class="index-strategy-each-inputs">
                  <integer-input
                    @valueUpdated="v => updateInput('plan_through_age', v)"
                    :default="inputs.plan_through_age"
                    max="120"
                  />
                </div>
            </div>
            <div class="col-md-12 pt-20">
                <h6 class="form-heading mb-0">Growth & Tax Details</h6>
            </div>
            <div class="col-md-6 col-lg-3 inp-mar-top">
                <label for="beginningBalance">Rate of Return<span><common-tooltip-svg />
                        <span>This will apply to the IRA or 401K and the reinvested
                            capital</span>
                    </span></label>
                <div class="index-strategy-each-inputs">
                  <decimal-input
                    @valueUpdated="v => updateInput('rate_of_return', v)"
                    :default="inputs.rate_of_return"
                    max="12"
                    placeholder="&nbsp;"
                  />
                  <span class="percent">%</span>
                </div>
            </div>
            <div class="col-md-6 col-lg-3 inp-mar-top">
                <label for="beginningBalance">Initial Tax Rate</label>
                <div class="index-strategy-each-inputs">
                  <decimal-input
                    @valueUpdated="v => updateInput('initial_tax_rate', v)"
                    :default="inputs.initial_tax_rate"
                    max="99"
                    placeholder="&nbsp;"
                  />                  
                  <span class="percent">%</span>
                </div>
            </div>
            <div class="col-md-6 col-lg-3 inp-mar-top">
                <label for="beginningBalance">Second Tax Rate <span
                        class="optional-label">(optional)
                    </span></label>
                <div class="index-strategy-each-inputs">
                  <decimal-input
                    @valueUpdated="v => updateInput('second_tax_rate', v)"
                    :default="inputs.second_tax_rate"
                    max="99"
                    placeholder="&nbsp;"
                  />
                  <span class="percent">%</span>
                </div>
            </div>
            <div class="col-md-6 col-lg-3 inp-mar-top">
                <label for="beginningBalance">Switch Year<span><common-tooltip-svg />
                        <span>What year should the second tax rate take
                            effect?</span>
                    </span></label>
                <div :class="`index-strategy-each-inputs ${switch_year_valid ? '' : 'error'}`">
                  <integer-input
                    @valueUpdated="v => updateInput('switch_year', v)"
                    :default="inputs.switch_year"
                  />
                </div>
            </div>
            <div class="col-md-12 pt-20">
                <h6 class="form-heading mb-0">Social Security Details</h6>
            </div>
            <div class="col-md-6 col-lg-3 inp-mar-top">
                <label for="beginningBalance">Social Security Amount <span
                        class="optional-label">(optional)
                    </span></label>
                <div class="index-strategy-each-inputs dollar">
                    <span>$</span>
                    <dollar-amount-input
                      @amountUpdated="a => updateInput('social_security_amount', a)"
                      :default="inputs.social_security_amount"
                      max="150000"
                      placeholder="&nbsp;"
                    />
                </div>
            </div>
            <div class="col-md-6 col-lg-3 inp-mar-top">
                <label for="beginningBalance">Social Security Age</label>
                <div :class="`index-strategy-each-inputs ${social_security_age_valid ? '' : 'error'}`">
                  <integer-input
                    @valueUpdated="v => updateInput('social_security_age', v)"
                    :default="inputs.social_security_age"
                    max="99"
                    placeholder="&nbsp;"
                  />
                </div>
            </div>
            <div class="col-md-6 col-lg-3 inp-mar-top">
                <label for="beginningBalance">Social Security COLA <span
                        class="optional-label">(optional)
                    </span><span><common-tooltip-svg />
                        <span>What is the annual Cost of Living Adjustment rate?</span>
                    </span></label>
                <div class="index-strategy-each-inputs">
                  <decimal-input
                    @valueUpdated="v => updateInput('social_security_cola', v)"
                    :default="inputs.social_security_cola"
                    max="10"
                    placeholder="&nbsp;"
                  />
                  <span class="percent">%</span>
                </div>
            </div>
            <div class="col-md-6 col-lg-3 inp-mar-top">
                <label for="filingStatus">Filing Status</label>
                <div id="filingStatus" :class="`select-menu ${filing_status_valid ? '' : 'error'} `">
                  <div class="select-btn">
                    <span class="sBtn-text"></span>
                    <i
                      ><img
                        src="@/assets/images/icons/select-chevron.svg"
                        alt="Chevron"
                    /></i>
                  </div>
                  <ul class="options">
                    <li class="option">
                      <span class="option-text">Single</span>
                    </li>
                    <li class="option">
                      <span class="option-text">Married</span>
                    </li>
                  </ul>
                </div>
            </div>

            <div class="col-md-12 pt-20">
                <h6 class="form-heading mb-0">Conversion Details</h6>
            </div>            
            <div class="col-md-6 col-lg-3 inp-mar-top pb-2">
                <label for="beginningBalance">Conversion Period (Years)<span><common-tooltip-svg />
                        <span>Convert to a tax-free plan over how many years?</span>
                    </span></label>
                <div class="index-strategy-each-inputs">
                  <integer-input
                    @valueUpdated="v => updateInput('roth_conversion_years', v)"
                    :default="inputs.roth_conversion_years"
                    max="20"
                  />
                </div>
            </div>
            <div class="col-md-6 col-lg-3 inp-mar-top pb-2">
                <label for="beginningBalance">Add’l Conversion Tax <span
                        class="optional-label">(optional)</span> <span><common-tooltip-svg />
                        <span class="w-250">Additional percentage points of taxation during the conversion period. For example, if you are assuming a 20% tax rate but wish to assume a 22% tax rate during the conversion period, you would enter “2” here.</span>
                    </span></label>
                <div class="index-strategy-each-inputs">
                  <decimal-input
                    @valueUpdated="v => updateInput('additional_conversion_tax', v)"
                    :default="inputs.additional_conversion_tax"
                    max="12"
                    placeholder="&nbsp;"
                  />
                  <span class="percent">%</span>
                </div>
            </div>
            <div class="col-md-6 col-lg-3 inp-mar-top">
                <label for="bonusOnConversion">Bonus on Conversions <span><common-tooltip-svg />
                        <span>Does the vehicle you are converting to offer a bonus?</span>
                    </span></label>
                <div id="bonusOnConversion" class="select-menu">
                  <div class="select-btn">
                    <span class="sBtn-text"></span>
                    <i><img src="@/assets/images/icons/select-chevron.svg" alt="Chevron"/></i>
                  </div>
                  <ul class="options">
                    <li class="option">
                      <span class="option-text">No</span>
                    </li>
                    <li class="option">
                      <span class="option-text">Yes</span>
                    </li>
                  </ul>
                </div>
            </div>
            <div class="col-md-6 col-lg-3 inp-mar-top">
                <label for="bonusAmount">Bonus Amount</label>
                <div class="index-strategy-each-inputs">
                  <decimal-input
                    placeholder="&nbsp;"
                  />
                  <span class="percent">%</span>
                </div>
            </div>
        </div>
    </div>
  </div>
</template>

<script>

import { mapState } from "vuex"
import { post } from "../../../network/requests"
import { getUrl } from "../../../network/url"
import { authHeader } from "../../../services/helper"
import DollarAmountInput from "./DollarAmountInput.vue"
import IntegerInput from "./IntegerInput.vue"
import DecimalInput from "./DecimalInput.vue"
import CommonTooltipSvg from "../../components/common/CommonTooltipSvg.vue";

export default {
  components: {
    DollarAmountInput, IntegerInput, DecimalInput, CommonTooltipSvg
  },

  computed: {
    ...mapState({
      inputs: state => state.data.tax_scorecard.inputs,
      social_security_age_valid: state => state.data.tax_scorecard.validation.social_security_age_valid,
      switch_year_valid: state => state.data.tax_scorecard.validation.switch_year_valid,
      filing_status_valid: state => state.data.tax_scorecard.validation.filing_status_valid,
    })
  },

  mounted() {
    this.validateForm(this.inputs);

    if (this.inputs.filing_status) {
      let text = this.inputs.filing_status.charAt(0).toUpperCase() + this.inputs.filing_status.slice(1)
      document.getElementById("filingStatus").querySelector(".sBtn-text").innerText = text
    }

    // Select Dropdown Start
    let selectBtn = document.querySelectorAll(".select-btn");
    selectBtn.forEach((showHide) => {
      showHide.addEventListener("click", () =>
        showHide.closest(".select-menu").classList.toggle("active")
      );
      console.log(showHide);
      var allOptions = showHide
        .closest(".select-menu")
        .querySelector(".options")
        .querySelectorAll(".option");
      allOptions.forEach((option) => {
        option.addEventListener("click", (e) => {
          e.stopPropagation();
          let items = e.target.closest('ul').querySelectorAll('li');
          items.forEach(element => {
            element.classList.remove('active');
          });
          e.target.closest('li').classList.add('active');
          let selectedOption = option.querySelector(".option-text").innerText;
          option.parentElement.parentElement.querySelector('.select-btn').querySelector('.sBtn-text').innerText = selectedOption;
          option.parentElement.parentElement.classList.remove("active");
          if(e.currentTarget.closest(".select-menu").getAttribute("id") == "filingStatus"){
            this.updateInput("filing_status", selectedOption.toLowerCase());
          }
        });
      });
    });

    // Close when click outside
    window.onclick = function (event) {
      if (!event.target.matches(".select-menu")) {
        var sharedowns = document.getElementsByClassName("select-menu");
        var i;
        for (i = 0; i < sharedowns.length; i++) {
          var openSelectdropdown = sharedowns[i];
          if (openSelectdropdown.classList.contains("active")) {
            openSelectdropdown.classList.remove("active");
          }
        }
      }
    };

    var allSelectMenus = document.querySelectorAll(".select-menu");
    allSelectMenus.forEach((eachSelectMenus) => {
      eachSelectMenus.addEventListener("click", function (event) {
        event.stopPropagation();
      });
    });
  },

  methods: {

    validateForm: function(inputs) {

      let valid = true
      let social_security_age_valid = true
      let filing_status_valid = true
      let switch_year_valid = true

      if (!inputs.ira_or_401k_balance || !inputs.age || !inputs.plan_through_age ||
          !inputs.rate_of_return || !inputs.initial_tax_rate || !inputs.roth_conversion_years) {
        valid = false
      }
      
      if (inputs.social_security_amount && !inputs.social_security_age) {
        valid = false
        social_security_age_valid = false
      }

      if (inputs.social_security_age && !inputs.filing_status) {
        valid = false
        filing_status_valid = false
      }

      if (inputs.second_tax_rate && !inputs.switch_year) {
        valid = false
        switch_year_valid = false
      }

      this.$store.dispatch("updateTaxScorecardFormValidation", {
        "form_valid": valid, "social_security_age_valid": social_security_age_valid,
        "switch_year_valid": switch_year_valid, "filing_status_valid": filing_status_valid
      })
    },

    validate_before_request: function(inputs) {

      let errors = []

      if (inputs.second_tax_rate) {
        if (inputs.switch_year < 1 || inputs.switch_year > inputs.plan_through_age) {
          errors.push(`Switch year must be between 1 and Plan Through Age (${inputs.plan_through_age}).`)
        }
      }

      if (inputs.plan_through_age <= inputs.age) {
        errors.push(`Plan Through Age must be greater than Age (${inputs.age}).`)
      }

      if (inputs.social_security_amount) {
        if (inputs.social_security_age < 62) {
          errors.push(`Social Security Age must at least 62.`)
        }
      } else if (inputs.social_security_age) {
        errors.push(`Social Security Age also requires Social Security Amount.`)
      }

      if(inputs.rmd_age){
        if (inputs.rmd_age < 72) {
          errors.push(`RMD Age must be at least 72.`)
        }
      }else{
        errors.push(`RMD Age required.`)
      }


      if (inputs.switch_year && !inputs.second_tax_rate) {
        errors.push(`Switch Year also requires Second Tax Rate.`)
      }

      for (let error of errors) {
        this.$toast.error(error)
      }

      return errors.length == 0
    },

    generateTaxScorecard: function() {

      if (!this.validate_before_request(this.inputs)) {
        return
      }

      this.$store.dispatch("loader", true)

      // Make a copy since the this.inputs is a vuex proxy object.
      let inputs = {...this.inputs}

      this.$store.dispatch("updateTaxScorecardInputs", inputs)

      if (inputs.second_tax_rate) {
        inputs.second_tax_rate = this.percentToDecimal(inputs.second_tax_rate)
      } else {
        inputs.second_tax_rate = null
      }

      if (!inputs.switch_year) {
        inputs.switch_year = null
      }

      if (!inputs.social_security_amount) {
        inputs.social_security_amount = null
      }

      if (!inputs.social_security_age) {
        inputs.social_security_age = null
      }

      inputs.rate_of_return = this.percentToDecimal(inputs.rate_of_return)
      inputs.initial_tax_rate = this.percentToDecimal(inputs.initial_tax_rate)
      inputs.social_security_cola = this.percentToDecimal(inputs.social_security_cola)
      inputs.roth_conversion_years = inputs.roth_conversion_years ? inputs.roth_conversion_years : 0

      if (inputs.additional_conversion_tax) {
        inputs.additional_conversion_tax = this.percentToDecimal(inputs.additional_conversion_tax)
      }

      post(getUrl("tax_scorecard"), inputs, authHeader())
        .then((response) => {
          this.$store.dispatch("loader", false)
          this.$store.dispatch("updateTaxScorecardResults", response.data)
          this.$emit("success")
          this.$router.push("/tax-risk-analysis")
        })
        .catch((error) => {
          this.$store.dispatch("loader", false)
          if (error.code === "ERR_BAD_RESPONSE" || error.code === "ERR_NETWORK") {
            this.$toast.error(error.message)
          } else if (error.code === "ERR_BAD_REQUEST") {
            if (error.response.data.error) {
                this.$toast.error(error.response.data.error[0])
            } else {
                let field = Object.entries(error.response.data)[0][0]
                let message = Object.entries(error.response.data)[0][1][0]
                this.$toast.error(field + ": " + message)
            }
          } else {
            this.$toast.error(error.message)
          }
        });
    },

    updateInput(field, value) {
      let inputs = {...this.inputs, [field]: value}
      this.$store.dispatch("updateTaxScorecardInputs", inputs)
      this.validateForm(inputs)
    },

    resetForm: function() {
      this.$store.dispatch("resetTaxScorecardInputs")
      document.getElementsByClassName("sBtn-text")[0].innerText = ""
      document.getElementById("filingStatus").querySelector(".sBtn-text").innerText = ""
    },

    percentToDecimal(value) {
      let parts = String(value).split(".")
      let decimalCount = parts.length > 1 ? parts[1].length : 0
      let rounding = Math.pow(10, decimalCount + 2)
      value = parseFloat(value)
      return Math.round(value / 100 * rounding) / rounding
    }


  }
};

</script>
